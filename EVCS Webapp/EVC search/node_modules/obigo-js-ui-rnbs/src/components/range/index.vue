<template>
  <div
    class="obg-range"
    :class="{ 'obg-range-disabled': disabled }"
    :style="{ 'width': rangeWidth + 'px'}"
  >
    <div class="obg-range-button down" ref="down" @click="valueDown">
    </div>
    <obg-slider
      :min="min"
      :max="max"
      :step="step"
      :barHeight="barHeight"
      :sliderWidth="sliderWidth"
      :focus="focus"
      v-model="model"
      @input="onInput"
    ></obg-slider>
    <div class="obg-range-button up" ref="up" @click="valueUp">
    </div>
  </div>
</template>
<script type="text/babel">
  /**
   * @class range
   * @classdesc components/range
   * @param {number} [min=0]
   * @param {number} [max=100]
   * @param {number} [step=1]
   * @param {number} [value=0]
   * @param {number} [barHeight=5]
   * @param {number} [sliderWidth=500]
   * @param {number} [rangeWidth=500]
   * @param {number} [stepPercent=1]
   * @param {boolean} [draggable=true]
   * @param {boolean} [disabled=false]
   * @event {number} [input]
   *
   * @example
   * import Range from 'obigo-js-ui/components/range'
   * <obg-range
   *  v-model="model"
   *  :min="0"
   *  :max="100"
   *  :stepPercent="10"
   *  @input="onInput"
   *  ></obg-range>
   */
  import longpress from '../../features/longPress'
  import slider from '../slider'
  export default {
    name: 'obg-range',
    components: {
      'obg-slider': slider
    },
    props: {
      min: {
        type: Number,
        default: 0
      },
      max: {
        type: Number,
        default: 100
      },
      step: {
        type: Number,
        default: 1
      },
      disabled: {
        type: Boolean,
        default: false
      },
      value: {
        type: Number,
        default: 0
      },
      barHeight: {
        type: Number
      },
      sliderWidth: {
        tyep: Number
      },
      rangeWidth: {
        type: Number,
        default: 700
      },
      stepPercent: {
        type: Number,
        default: 1
      }
    },
    data () {
      return {
        model: (this.value < this.min) ? this.min : this.value,
        focus: false,
        counter: 0,
        weight: 1
      }
    },
    mounted () {
      const up = this.$refs.up
      const down = this.$refs.down
      this.onepercent = Math.ceil((this.max - this.min) / 100)
      longpress(up, {
        counter: () => {
          // this.addCount()
          this.valueUp()
        },
        end: () => {
          this.onInput(this.model)
          this.reset()
        }
      })
      longpress(down, {
        counter: () => {
          // this.addCount()
          this.valueDown()
        },
        end: () => {
          this.onInput(this.model)
          this.reset()
        }
      })
      this.$on('jogclick', () => {
        this.focus = !(this.focus)
        if (this.focus) {
            // TODO add jog event listner - value up/down
        } else {
            // TODO remove jog event
        }
      })
      this.$on('focusout', () => {
        this.focus = false
      })
    },
    methods: {
      valueDown () {
        // this.model = this.model - this.onepercent * this.weight
        this.model = this.model - this.onepercent * this.stepPercent
        if (this.model < this.min) this.model = this.min
        this.$emit('input', this.model)
      },
      valueUp () {
        // this.model = this.model + this.onepercent * this.weight
        this.model = this.model + this.onepercent * this.stepPercent
        if (this.model > this.max) this.model = this.max
        this.$emit('input', this.model)
      },
      onInput (val) {
        this.$emit('input', val)
      },
      reset () {
        this.counter = 0
        this.onepercent = Math.ceil((this.max - this.min) / 100)
        this.weight = 1
      },
      addCount () { // TODO 가중치에 대해서는 논의 후 결정
        this.counter++
        if (this.counter % 8 === 0) {
          if (this.weight < 12) {
            this.weight += 4
          } else {
            this.weight = 10
          }
        }
      }
    }
  }
</script>

<style lang="scss" scoped>
  @import '../../styles/colors.variables.scss';
  .obg-range {
    position: relative;
    display: flex;
    height: 40px;
    line-height: 40px;
    color:color(black);
    text-align:center;
    & > .obg-range-button{
      min-height: 40px;
      min-width: 40px;
      border: 2px solid color(dark);
      background-color: color(dark);
      color:color(white);
      font-size: 30px;
      outline: none;
      user-select: none;
      border-radius: 20px;
      line-height: 28px;
      text-indent: 9px;
      &:active{
        border-color: color(white);
        box-shadow: none;
        color: color(white);
        background-color: color(secondary);
      }
      &.down{
        margin-right: 25px;
        &:after{
          content: '';
          top: 16px;
          left: 11px;
          border: 2px solid color(white);
          display: block;
          width: 12px;
          position: relative;
        }
      }
      &.up{
        margin-left: 15px;
        &:before{
          content: '';
          border: 2px solid color(white);
          display: block;
          height: 12px;
          float: left;
          margin-left: 17px;
          margin-top: 10px;
        }
        &:after{
          content: '';
          top: 16px;
          left: 11px;
          border: 2px solid color(white);
          display: block;
          width: 12px;
          position: relative;
        }
      }
    }
    &.obg-range-disabled {
      opacity: 0.5;
      user-select: none;
      pointer-events: none;
    }
  }

</style>
