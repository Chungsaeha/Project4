<template>
  <div
    class="obg-button-group"
    :class="[{
      'is-animated': animated
    }]"
    :style="{ width: buttonGroupWidth + 'px' }"
  >
    <div class="slide-factor" v-if="animated"></div>
    <slot></slot>
  </div>
</template>

<script>
/**
 * @class button-group
 * @classdesc components/button-group
 * @param {slot} [slot] button-group-item
 * @param {boolean} [animated=true]
 *
 * @example
 * import {ButtonGroup,ButtonGroupItem} from 'obigo-js-ui/components/button-group'
 * <obg-button-group v-model="btnGroup" :animated=true :value=2>
 *    <obg-button-group-item>A</obg-button-group-item>
 *    <obg-button-group-item selected>B</obg-button-group-item>
 *    <obg-button-group-item>C</obg-button-group-item>
 * </obg-button-group>
 */
import { parentMixin } from '../../mixins/multi-items'
import TWEEN from 'tween.js'

export default {
  name: 'obg-button-group',
  mixins: [parentMixin],
  data () {
    return {
    }
  },
  computed: {
    buttonGroupWidth: function () {
      var filtered = this.$slots.default.filter(function (item) { return (item.tag) })
      return filtered.length * 145
    }
  },
  props: {
    animated: {
      type: Boolean,
      default: true
    }
  },
  watch: {
    currentIndex (val) {
      if (this.animated) {
        var startValue
        this.slidePosition = this.currentIndex * this.tweeningWidth
        if (this.previousIndex >= 0) {
          startValue = this.previousIndex * this.tweeningWidth
          this.tween(startValue, this.slidePosition, this.$slideFactor, 300)
        } else {
          this.tween(0, this.slidePosition, this.$slideFactor, 0)
        }
      }
    }
  },
  mounted () {
    this.clientWidth = this.$el.clientWidth
    this.tweeningWidth = this.clientWidth / this.number
    this.$slideFactor = this.$el.children[0]
    if (this.$children.length < 2 || this.$children.length > 5) {
      throw new Error('Count of Button-group-item is ' + this.$children.length + '\n Number of Button-group-item should be 2~5')
    }
  },
  methods: {
    tween: function (startValue, endValue, el, duration) {
      var _el = el
      var animationFrame
      function animate (time) {
        TWEEN.update(time)
        animationFrame = requestAnimationFrame(animate)
      }
      new TWEEN.Tween({left: startValue})
        .to({ left: endValue }, duration)
        .onUpdate(function () {
          _el.style.transform = 'translateX(' + this.left + 'px)'
          _el.style.webkitTransform = 'translateX(' + this.left + 'px)'
        })
        .onComplete(function () {
          cancelAnimationFrame(animationFrame)
        })
        .start()
      animationFrame = requestAnimationFrame(animate)
    }
  }
}
</script>

<style lang="scss">
  .obg-button-group{
    display: flex;
    background-color: #1a1a1a;
    border-radius: 34px;
    border: 2px solid #7b7b7b;
    position: relative;
    & > a{
      text-decoration:none;
    }
    &.is-animated > a.obg-button-group-current{
      border:2px solid transparent;
      background:none;
      &:active{
        border: 2px solid white;
        background: #00596b;
      }
    }
    .slide-factor{
      position: absolute;
      width: 147px;
      height: 60px;
      border:2px solid #7b7b7b;
      background-color: #7b7b7b;
      border-radius: 30px;
      left:-1px;
      &:active{
        border:2px solid rgb(255, 255, 255);
        background: rgb(0, 89, 107);
      }
    }
  }

</style>
