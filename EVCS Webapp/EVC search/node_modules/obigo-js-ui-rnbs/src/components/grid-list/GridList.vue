<template>
    <div class='obg-grid-list' >
        <div class='obg-grid-list-inner' >
			<slot></slot>
        </div>
    </div>
</template>

<script>
import IScroll from '../../libs/iscroll'
/**
 * obg-grid-list
 * @class grid list
 * @classdesc components/grid-list
 * @param {number} [row=2]
 * @param {number} [col=4]
 *
 * @example
 * import {GridList,GridListItem} from 'obigo-js-ui/components/grid-list'
 * <obg-grid-list row=3 col=3 >
 *   <obg-grid-list-item >hello</obg-grid-list-item>
 *   <obg-grid-list-item >hello</obg-grid-list-item>
 *   <obg-grid-list-item >hello</obg-grid-list-item>
 *   <obg-grid-list-item >hello</obg-grid-list-item>
 *   <obg-grid-list-item >hello</obg-grid-list-item>
 * </obg-grid-list>
 */
export default {

  name: 'obg-grid-list',
  props: {
    col: {
      type: Number,
      default: 4
    },
    row: {
      type: Number,
      default: 2
    }
  },
  data: function () {
    return {
      width: 800,
      height: 420,
      padding: 5
    }
  },
  methods: {
    makePositions: function () {
      var itemCountInPage = this.col * this.row
      var len = this.$slots.default.length
      var realIdx = 0

      for (var i = 0; i < len; i++) {
        if (this.$slots.default[i].tag === undefined) {
          continue
        }
        var nowPage = Math.floor(realIdx / itemCountInPage)

        this.$slots.default[i].elm.style.width = ((this.width / this.col) - this.padding) + 'px'
        this.$slots.default[i].elm.style.height = ((this.height / this.row) - (this.padding * 2)) + 'px'

        this.$slots.default[i].elm.style.left = (nowPage * this.width) + ((realIdx % this.col) * (this.width / this.col)) + 'px'
        this.$slots.default[i].elm.style.top = Math.floor((realIdx % itemCountInPage) / this.col) * (this.height / this.row) + 'px'
        realIdx++
      }
      this.$el.firstChild.style.width = this.width * Math.ceil((realIdx / itemCountInPage)) + 'px'
    },
    refreshScroll: function () {
      if (this.$scroll) {
        this.$scroll.refresh()
      } else {
        this.makeScroll()
      }
    },
    makeScroll: function () {
      if (this.$el.querySelectorAll('.obg-grid-list-inner > *').length === 0 || this.$slots.default === undefined || this.$slots.default.length === 0) {
        return
      }
      this.makePositions()
      this.$scroll = new IScroll(this.$el, {
        probeType: 2,
        scrollY: false,
        scrollX: true,
        bounce: false,
        mouseWheel: false,
        scrollbars: true,
        fadeScrollbars: true,
        interactiveScrollbars: false,
        click: true,
        snap: true,
        disableMouse: false,
        disablePointer: true
      })
    }
  },
  updated: function () {
    this.makePositions()
    this.refreshScroll()
  },
  mounted: function () {
    this.makeScroll()
  },
  beforeDestroy: function () {
    if (this.$scroll) {
      this.$scroll.destroy()
    }
  }

}
</script>
<style lang='scss' scoped >
.obg-grid-list{
    margin:auto;
    padding-top:10px;
	width:800px;
	height:420px;
	position:relative;
	overflow:hidden;
    padding-left:2.5px;
}
</style>

