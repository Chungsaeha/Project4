<template>
  <div class='obg-list' >
    <div class='scroll-container' >
      <slot></slot>
      <div class='dummy-item' v-if="hideDummyItem == false && isEmpty == false" ></div>
    </div>
  </div>
</template>

<script>
import IScroll from '../../libs/iscroll'
/**
 * obg-list
 * @class list
 * @classdesc components/list
 * @param {boolean} [hideDummyItem=false] hide/show last dummy item.
 * @param {Number} [targetElementIndex] scroll to targetElement when updated
 * @example
 * import {List,ListItem} from 'obigo-js-ui/components/list'
 * <obg-list >
 *  <obg-list-item>item1</obg-list-item>
 *  <obg-list-item>item2</obg-list-item>
 *  <obg-list-item>item3</obg-list-item>
 * </obg-list>
 */
export default {
  name: 'obg-list',
  props: {
    hideDummyItem: {
      type: Boolean,
      default: false
    },
    targetElementIndex: {
      type: Number
    }
  },
  data () {
    return {
      isEmpty: true
    }
  },
  methods: {
    makeScroll: function () {
      if (this.$el.querySelectorAll('.scroll-container > .obg-list-item, .scroll-container > .obg-accordion').length === 0 || this.$slots.default === undefined || this.$slots.default.length === 0) {
        this.isEmpty = true
        return
      }
      this.isEmpty = false
      this.$scroll = new IScroll(this.$el, {
        probeType: 2,
        bounce: true,
        mouseWheel: false,
        scrollbars: true,
        fadeScrollbars: true,
        interactiveScrollbars: false,
        click: true,
        disableMouse: false,
        disablePointer: true,
        snap: '.obg-list-item, .obg-accordion',
        preventDefaultException: {
          // default config, all form elements,
          // extended with a WebComponents Custom Element from the future
          tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|X-WIDGET)$/,
          // and allow any element that has an accessKey (because we can)
          accessKey: /.+/
        }
      })
      this.scrollToElement(this.targetElementIndex)
      window.scroll = this.$scroll
    },
    refreshScroll: function () {
      console.log('scroll update')
      if (this.$scroll) {
        if (this.$el.querySelectorAll('.scroll-container > .obg-list-item, .scroll-container > .obg-accordion').length === 0 || this.$slots.default === undefined || this.$slots.default.length === 0) {
          this.isEmpty = true
          return
        } else {
          this.isEmpty = false
          this.$scroll.refresh()
          this.scrollToElement(this.targetElementIndex)
        }
      } else {
        this.makeScroll()
      }
    },
    scrollToElement: function (index) {
      if (index !== undefined && this.$slots.default[index]) {
        this.$scroll.scrollToElement(this.$slots.default[index].elm, 0)
      }
    }

  },
  updated: function () {
    this.refreshScroll()
  },
  mounted: function () {
    this.makeScroll()
    this.$on('updateScroll', this.refreshScroll)
  },
  beforeDestroy: function () {
    if (this.$scroll) {
      this.$scroll.destroy()
    }
  }

}
</script>
<style lang="scss" scoped >
  .obg-list{
    width:100%;
    height:420px;
    position:relative;
    overflow:hidden;
    color:white;
    .dummy-item{
      width:100%;
      height:78px;
    }
  }
</style>

