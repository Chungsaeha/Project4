/**
 * Created by krinjadl on 2017-03-28.
 */
let isHolding = false
let longPressDuration = 500
let timer = null
let duration = 500
let minDuration = 100
let counter = 0

export default function (element, options) {
  const holdRelease = function (event) {
    document.removeEventListener('mouseup', holdRelease)
    document.onselectstart = null
    reset()
    clearTimeout(timer)
    if (options.end) {
      options.end(event)
    }
  }
  const startCounter = function () {
    timer = setTimeout(() => {
      options.counter(++counter)
      if (counter % 3 === 0) {
        duration = (duration / 2 > minDuration) ? duration / 2 : minDuration
      }
      startCounter()
    }, duration)
  }
  const reset = function () {
    isHolding = false
    duration = 1000
    counter = 0
  }
  element.addEventListener('mousedown', function (event) {
    if (isHolding) return
    event.preventDefault()
    document.onselectstart = function () { return false }

    document.addEventListener('mouseup', holdRelease)

    timer = setTimeout(() => {
      isHolding = true
      clearTimeout(timer)
      if (options.start) {
        options.start(event)
      }
      if (options.counter) {
        startCounter()
      }
    }, longPressDuration)
  })
}
